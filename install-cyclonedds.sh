#!/bin/bash

dir=$(cd `dirname $0`;pwd)

rm -rf cyclonedds

git clone https://github.com/fuboat/CVE-project-install-script cyclonedds-tmp
cp -r cyclonedds-tmp/projects/cyclonedds cyclonedds
rm -rf cyclonedds-tmp
cd cyclonedds || exit

mkdir build
cd build || exit
cmake ../src
make

cd ..

$CC -c $CFLAGS $CPPFLAGS $LDFLAGS src/fuzz/fibheap/fibheapfuzz.c \
-I src/util/include \
-I src/os/include \
-I build/os/include \
-I build/os/exports \
-I build/util/exports \
-g -o fibheap-fuzz.o

$CC $CXXFLAGS $CPPFLAGS $LDFLAGS fibheap-fuzz.o \
build/util/CMakeFiles/util.dir/src/ut_fibheap.c.o \
-I "$dir"/include \
"$dir"/others/afl-compiler-rt.o \
"$dir"/others/aflpp_driver.c \
     -o cyclonedds
