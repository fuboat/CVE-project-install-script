#!/bin/bash

rm -rf cyclonedds

git clone https://github.com/fuboat/CVE-project-install-script cyclonedds-tmp
cp -r cyclonedds-tmp/projects/cyclonedds cyclonedds
rm -rf cyclonedds-tmp
cd cyclonedds || exit

mkdir build
cd build || exit
cmake ../src
make

cd ..

$CC -c $CFLAGS $CPPFLAGS $LDFLAGS src/fuzz/fibheap/fibheapfuzz.c \
-I src/util/include \
-I src/os/include \
-I build/os/include \
-I build/os/exports \
-I build/util/exports \
-g -o fibheap-fuzz.o

wget https://raw.githubusercontent.com/fuboat/CVE-project-install-script/main/others/FuzzingEngine.a -O FuzzingEngine.a
$CXX $CXXFLAGS $CPPFLAGS $LDFLAGS -fsanitize=address fibheap-fuzz.o \
build/util/CMakeFiles/util.dir/src/ut_fibheap.c.o \
FuzzingEngine.a \
-o fibheap-fuzz