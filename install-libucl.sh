#!/bin/bash

rm -rf libucl

git clone https://github.com/vstakhov/libucl
cd libucl || exit
git checkout 0af751def7675c68657a717b3a2686587c84fb09 -f

mkdir build
cd build || exit
cmake ..
make

cd ..
$CC $CFLAGS $CPPFLAGS -c tests/fuzzers/ucl_msgpack_fuzzer.c -I ./include/ -I ./src/  -I ./uthash/ -o ucl_msgpack_fuzzer.o

wget https://raw.githubusercontent.com/fuboat/CVE-project-install-script/main/others/FuzzingEngine.a -O FuzzingEngine.a
$CXX $CXXFLAGS $CPPFLAGS $LDFLAGS -fsanitize=address \
ucl_msgpack_fuzzer.o -L ./build/ -lucl FuzzingEngine.a -o libucl
