#include "util/ut_fibheap.h"
#include <stdio.h>

struct heap_node {
  ut_fibheapNode_t heapnode;
  int64_t h;      /* constant */
};


ut_fibheap_t fuzzheap;


static int cmp_heap_fuzz (const void *va, const void *vb)
{
  const struct heap_node *a = va;
  const struct heap_node *b = vb;
  return (a->h) - (b->h);
}

extern int LLVMFuzzerTestOneInput(const unsigned char *buf, size_t len) {
    static const ut_fibheapDef_t fuzz_fhdef = UT_FIBHEAPDEF_INITIALIZER(offsetof (struct heap_node, heapnode), cmp_heap_fuzz);
    ut_fibheapInit (&fuzz_fhdef, &fuzzheap);
// *ut_fibheapMin (const ut_fibheapDef_t *fhdef, const ut_fibheap_t *fh);

// ut_fibheapInsert (const ut_fibheapDef_t *fhdef, ut_fibheap_t *fh, const void *vnode);
// ut_fibheapDelete (const ut_fibheapDef_t *fhdef, ut_fibheap_t *fh, const void *vnode);
// *ut_fibheapExtractMin (const ut_fibheapDef_t *fhdef, ut_fibheap_t *fh);
// ut_fibheapDecreaseKey (const ut_fibheapDef_t *fhdef, ut_fibheap_t *fh, const void *vnode); /* to be called AFTER decreasing the key */
    unsigned long addcnt = 0;
    for(unsigned long i = 0; i < len; i++) {
        uint8_t value = ((uint8_t *)buf)[i];
        struct heap_node *tmp =(struct heap_node *)malloc(sizeof(struct heap_node));
        tmp->h = value;
        ut_fibheapInsert (&fuzz_fhdef, &fuzzheap, tmp);
        struct heap_node *p = ut_fibheapMin(&fuzz_fhdef, &fuzzheap);
        addcnt++;
    }
    for(unsigned long i = 0; i < addcnt; i++) {
        struct heap_node *t = ut_fibheapExtractMin(&fuzz_fhdef, &fuzzheap);
        free(t);
    }
    return 0;
}
