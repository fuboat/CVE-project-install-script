#include <stdio.h>
#include <stdint.h>
#include "light_matrix.h"

size_t read_len = 0;
int readint(uint8_t **s, size_t len) {
    int sum = 0;
    while (read_len < len) {
        read_len++;
        int x = **s;
        (*s)++;
        if (x == ' ')
            return sum;
        else
            sum = sum * 10 + x - '0';
    }
    return sum;
}

extern int LLVMFuzzerTestOneInput(uint8_t *data, size_t size) {
    Mat a;
    Mat b;
    Mat c;
    Mat sum;
    Mat product;
    int row = readint(&data,size);
    int col = readint(&data,size);
    if(row > 200 || col > 200) {
        return 0;
    }
    MatCreate(&a, row, col);
    MatCreate(&b, row, col);
    MatCreate(&c, col, row);
    MatCreate(&sum, col, row);
    MatCreate(&product, row, row);
    MatAdd(&a, &b, &sum);
    MatTrans(&a, &c);
    MatMul(&b, &c, &product);
    MatDelete(&a);
    MatDelete(&b);
    MatDelete(&c);
    MatDelete(&sum);
    MatDelete(&product);
    return 0;
}
