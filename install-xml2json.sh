#!/bin/bash

rm -rf xml2json
git clone https://github.com/Cheedoong/xml2json
cd xml2json || exit
git checkout -f d3a3d98f1a35347e718f7998df598915c3c62fa5

# modify src code
sed -i '28s/.*/#define RAPIDXML_PARSE_ERROR(what, where) { exit(1); }/' include/rapidxml/rapidxml.hpp
sed -i '29s/.*/#define RAPIDXML_EOF_ERROR(what, where) { exit(1); }/' include/rapidxml/rapidxml.hpp
sed -i '56s/.*/#define RAPIDXML_PARSE_ERROR(what, where) exit(1)/' include/rapidxml/rapidxml.hpp
sed -i '57s/.*/#define RAPIDXML_EOF_ERROR(what, where) exit(1)/'

# modify compile args
#sed -i '5s/.*/LINKOPTIONS = ${LDFLAGS} -Wl,-search_paths_first -Wl,-dead_strip -v/' Makefile
#sed -i '7s/.*/LINKOPTIONS = ${LDFLAGS} -Wl,--gc-sections -Wl,--strip-all/' Makefile
#sed -i '11s/.*/COMPILEOPTIONS  = ${CPPFLAGS} ${CXXFLAGS} -std=c++11 -O3 -fdata-sections -ffunction-sections/' Makefile
#
#make

$CXX $CPPFLAGS $CXXFLAGS $LDFLAGS xml2json.cpp -I ./include -o xml2json
