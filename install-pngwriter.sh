#!/bin/bash

git clone https://github.com/pngwriter/pngwriter.git
cd pngwriter || exit
git checkout 79bb3ef5ebd91996bc4cd02cdc031c5cd560b897 -f
export CC=gcc CXX=g++ CFLAGS="-g -fsanitize=address" CXXFLAGS="-g -fsanitize=address"
cmake .
make -j


mkdir crashes
wget https://raw.githubusercontent.com/fouzhe/security/master/pngwriter/crash_SEGV_readfromfile \
     -O crashes/crash_SEGV_readfromfile
./blackwhite crashes/crash_SEGV_readfromfile > /dev/null
