#!/bin/bash

# target program: ./bitmap/test

rm -rf bitmap

git clone https://github.com/wernsey/bitmap.git
cd bitmap || exit
git checkout 1d0592609a59c1019a6545f37a6283102abceea8 -f

sed -i '1s/.*//' Makefile
make

wget https://raw.githubusercontent.com/fuboat/CVE-project-install-script/main/others/bitmap--test.c -O test.c
$CXX -fsanitize=address test.c -L ./ -l bmp -lpng -ljpeg -lm -o test

mkdir crashes
wget https://raw.githubusercontent.com/fuboat/CVE-project-install-script/main/others/bitmap--testcase1.bmp \
    -O crashes/testcase1.bmp
./test crashes/testcase1.bmp
